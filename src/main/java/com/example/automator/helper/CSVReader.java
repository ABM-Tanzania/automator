package com.example.automator.helper;

import com.opencsv.CSVReaderBuilder;
import com.opencsv.bean.CsvToBean;
import com.opencsv.bean.CsvToBeanBuilder;


import java.io.FileReader;
import java.io.Reader;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Arrays;
import java.util.Iterator;
import java.util.List;

public class CSVReader {

    private static final String CSV_FILE_PATH_RESULTS = "optimization-results-go-here/";
    
    public Parameters parseDataCSV(String CSV_FILE_PATH_DATA) {
        try (
            Reader reader = Files.newBufferedReader(Paths.get(CSV_FILE_PATH_DATA));
        ) {

            // check CSV

            // create parameter instance from CSV
            CsvToBean<Parameters> csvToBean = new CsvToBeanBuilder(reader)
                .withType(Parameters.class)
                .withIgnoreLeadingWhiteSpace(true)
                .build();

            Iterator<Parameters> parameterIterator = csvToBean.iterator();

            while (parameterIterator.hasNext()) {
                Parameters parameters = parameterIterator.next();
                return parameters;
            }
        } catch(Exception e) {
            System.out.println(e);
        }
        return null;
    }

    public OptimizationResults parseResultsCSV(String fileName) {
        try (
            Reader reader = Files.newBufferedReader(Paths.get(CSV_FILE_PATH_RESULTS + fileName));
        ) {
            CsvToBean<OptimizationResults> csvToBean = new CsvToBeanBuilder(reader)
            .withType(OptimizationResults.class)
            .withIgnoreLeadingWhiteSpace(true)
            .build();

            Iterator<OptimizationResults> resultsIterator = csvToBean.iterator();

            while (resultsIterator.hasNext()) {
                OptimizationResults results = resultsIterator.next();
                return results;
            }
        } catch (Exception e) {
            System.out.println(e);
        }
        return null;
    }

    public String checkDataCSVHeader(String path) {
        try {
            // get header from csv
            com.opencsv.CSVReader testreader = new CSVReaderBuilder(new FileReader(path)).build();
            List<String[]> rows = testreader.readAll();
            String[] header = rows.get(0);

            // allowed headers
            List<String> headerList = Arrays.asList("start", "end", "today", "deviceid", "Enumerator: Capture GPS Location", "_Enumerator: Capture GPS Location_latitude", "_Enumerator: Capture GPS Location_longitude", "_Enumerator: Capture GPS Location_altitude", "_Enumerator: Capture GPS Location_precision", "Enumerator: Select your name", "Enumerator: Select Region", "Enumerator: Type Farmer Group ID number", "Enumerator: Select Farmer Group type", "Hello! My name is [Enumerator\'s name]. First, I would like to thank you for taking the time to meet with us. I represent a research project in Tanzania called Evidence-Based Scaling of Improved On-Farm Storage among Smallholders (LED Project). This project aims to enhance income and food security by increasing adoption of hermetic storage bag. \n\nThis study includes an interview, which will take approximately an hour. Data collected from households like yours will be used to understand major constraints and opportunities for improved on-farm storage technology’s adoption. \nAll the information you give will be strictly anonymous, and your name will not be associated with any of your responses or given to anyone outside our project. If you would rather not answer any questions, please say so. You may opt out of this interview at any time you wish. \n\nShould you have any question or concern, please contact Mr. Baraka Mbesa of SUA (+255717508854)", "Do you agree to participate according to the consent form explained by the enumerator and printed again here?", "Please confirm with your signature", "Please confirm with your signature_URL", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/What is your first name?", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/What is your surname?", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Do you have access to a Mobile phone?", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Which type of Mobile phone are you using?", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/What is your mobile phone number?", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/In what year were you born?", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Number of years the head of the household has been living in this village", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Enumerator: Gender of Participant", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/What is the gender of your head of household?", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Marital status", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Level of education", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Relation to the HH head", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/relation_other", "PART 1: INFO AND SOCIO-DEMOGRAPHICS/Main cccupation", "PART 2: STORAGE AND POST-HARVEST/Now, we would like to ask you some questions about the post-harvest loss and storage techniques of your household.", "PART 2: STORAGE AND POST-HARVEST/During the last 12 MONTHS, was any portion of your maize production lost post-harvest to rotting, insects, rodents, etc?", "PART 2: STORAGE AND POST-HARVEST/If the answer on previous is  “Yes”, out of 10 units of maize, how many were lost?", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?/Granary", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?/Underground structure", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?/Propylene bag", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?/Plastic containers/Jars", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?/Hermetic bag", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?/Metal silo", "PART 2: STORAGE AND POST-HARVEST/What kind of storage methods do you use?/other", "PART 2: STORAGE AND POST-HARVEST/methods_other", "PART 2: STORAGE AND POST-HARVEST/Have you ever heard of hermetic/airtight storage bags?", "PART 2: STORAGE AND POST-HARVEST/What brands of hermetic/airtight storage bags do you know?", "PART 2: STORAGE AND POST-HARVEST/What brands of hermetic/airtight storage bags do you know?/PICS", "PART 2: STORAGE AND POST-HARVEST/What brands of hermetic/airtight storage bags do you know?/AgroZ", "PART 2: STORAGE AND POST-HARVEST/What brands of hermetic/airtight storage bags do you know?/ZeroFly", "PART 2: STORAGE AND POST-HARVEST/What brands of hermetic/airtight storage bags do you know?/GrainPro", "PART 2: STORAGE AND POST-HARVEST/What brands of hermetic/airtight storage bags do you know?/Mifuko Safi", "PART 2: STORAGE AND POST-HARVEST/What brands of hermetic/airtight storage bags do you know?/other", "PART 2: STORAGE AND POST-HARVEST/HBBrand_other", "PART 2: STORAGE AND POST-HARVEST/How many hermetic storage bags do you currently use?", "PART 2: STORAGE AND POST-HARVEST/Have you received training on hermetic bag?", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Government extension service", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Farmer Coop or groups", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Neighbour/relative farmers", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/NGOs", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Private Company", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Farmer field school", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Radio/TV", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Newspaper", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Mobile phone", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Farmer’s training centres", "PART 2: STORAGE AND POST-HARVEST/Who provided the training?/Traders/Agro-dealers", "PART 2: STORAGE AND POST-HARVEST/How would you rate your knowledge on using hermetic bags?", "PART 2: STORAGE AND POST-HARVEST/With bags provided, do you still use them for grain storage?", "PART 2: STORAGE AND POST-HARVEST/What is the condition of those bags?", "PART 2: STORAGE AND POST-HARVEST/How did you dispose/use the hermetic bags if damaged/couldn’t be used anymore?", "PART 2: STORAGE AND POST-HARVEST/Did you purchase/do you plan to buy any additional hermetic bag(s)?", "PART 2: STORAGE AND POST-HARVEST/How many bags did/do you plan to purchase?", "PART 2: STORAGE AND POST-HARVEST/Why do you plan to purchase hermetic bag?", "PART 2: STORAGE AND POST-HARVEST/Why you do not plan to purchase hermetic bag?", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/Reduced losses in stored produce", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/Produce looks better after storage", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/Produce tastes better after storage", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/Better health: no pesticides needed", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/No costs for storage pesticides", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/Wait and sell at higher prices", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/Protect seeds from moisture", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/In your opinion, what are the main benefits of hermetic storage bags for you?/other", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/HBBenefit_other", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Maize storage", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Maize storage is a serious problem in farming.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Current maize storage technologies available in the market are not satisfying.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Maize mold/insect/pest is not a serious problem in farming.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic Bag design", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic bag does not ensure availability of food anytime throughout the year.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic bag will help to enhance income throughout the year.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic bag is unsafe for use to human health.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic bag can reduce food loss in stored grains", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic bag technology is a foreign material which should not be used in the farmer’s farms.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/There are other, better options than hermetic bags to solve food loss.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic Bag usage", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Hermetic storage bag use is difficult", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Using hermetic storage bags require assistance from extension officers", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/There is need to create product awareness (including grain loss reduction and aflatoxin control) so as to increase its demand among the farmers.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Social and environmental acceptability", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Use of hermetic storage bag will go against any culture or beliefs.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Use of hermetic storage bag can cause environmental pollution.", "PART 3: KNOWLEDGE, ATTITUDE AND PRACTICE/group7/Using hermetic storage bags reduces chemical use", "PART 4: CROP PRODUCTION (2022)/What is the exact number of acres of land that you own or hold?", "PART 4: CROP PRODUCTION (2022)/How many acres of land did you use to grow ALL CROPS in the past season?", "PART 4: CROP PRODUCTION (2022)/How many acres of land did you use to grow maize in the past maize harvest?", "PART 4: CROP PRODUCTION (2022)/How high was your yield in the past maize harvest?", "PART 4: CROP PRODUCTION (2022)/How many years have you been producing maize?", "PART 5: CONSUMPTION, BUYING AND SELLING/How many bags of maize does your household currently have in storage?", "PART 5: CONSUMPTION, BUYING AND SELLING/How many of the ${StoredExact} bags you currently have on storage do you plan to use as food for your household?", "PART 5: CONSUMPTION, BUYING AND SELLING/Out of the ${StoredExact} bags of maize you currently have on storage, how many do you plan to sell?", "PART 5: CONSUMPTION, BUYING AND SELLING/In a typical year, what is the month of the year where you have the most money on hand?", "PART 5: CONSUMPTION, BUYING AND SELLING/Recall past 7 days, how many days did you eat maize?", "PART 5: CONSUMPTION, BUYING AND SELLING/eat_other", "PART 5: CONSUMPTION, BUYING AND SELLING/Recall past 7 days, how many days did you buy maize from the market?", "PART 5: CONSUMPTION, BUYING AND SELLING/buy_other", "PART 5: CONSUMPTION, BUYING AND SELLING/Do you buy maize for consumption from the market?", "PART 5: CONSUMPTION, BUYING AND SELLING/Do you prefer buying maize from farmers you personally know?", "PART 5: CONSUMPTION, BUYING AND SELLING/prefer_other", "PART 5: CONSUMPTION, BUYING AND SELLING/Which types of maize do you prefer most?", "PART 5: CONSUMPTION, BUYING AND SELLING/apperance_other", "PART 5: CONSUMPTION, BUYING AND SELLING/If you buy, how many bags did you buy from the market for consumption during the last season? This means the time from last harvest to the current harvest. (in 100 kg bag)?", "PART 5: CONSUMPTION, BUYING AND SELLING/Do you sell maize in the market?", "PART 5: CONSUMPTION, BUYING AND SELLING/Do you sell maize to traders?", "PART 5: CONSUMPTION, BUYING AND SELLING/If you sell, how many bags did you sell during the last season (in 100kg bags)?", "PART 5: CONSUMPTION, BUYING AND SELLING/Which type of maize do your customers prefer?", "PART 5: CONSUMPTION, BUYING AND SELLING/Do maize stored hermetically fetches better prices?", "PART 5: CONSUMPTION, BUYING AND SELLING/Currently, how much would you have to pay for buying 1 debe of local maize?", "PART 5: CONSUMPTION, BUYING AND SELLING/Currently, how much money would you receive for selling 1 debe of local maize?", "PART 5: CONSUMPTION, BUYING AND SELLING/Think about your expectation for maize prices by March next year. What do you expect how much money would you receive for selling 1 debe of maize in March next year?", "PART 5: CONSUMPTION, BUYING AND SELLING/Number of traders that you know in this village who could buy your produce", "PART 5: CONSUMPTION, BUYING AND SELLING/Number of traders that you know outside this village who could buy your produce", "PART 6: FOOD SECURITY/For the next 5 questions reply only with the number of days your household took action because there was not enough food or money to buy food. Select \"Yes\" to continue", "PART 6: FOOD SECURITY/In the past 7 days, how many days did your household rely on less preferred or less expensive food due to lack of food/money? Reply number of days 0-7", "PART 6: FOOD SECURITY/In the past 7 days, how many days did your household borrow food or rely on help from a friend or relative due to lack of food/money? Reply number of days 0-7", "PART 6: FOOD SECURITY/In the past 7 days, how many days did your household reduce the number of meals eaten in a day due to lack of food/money? Reply number of days 0-7", "PART 6: FOOD SECURITY/In the past 7 days, how many days did your household limit portion sizes at mealtime due to lack of food/money? Reply number of days 0-7", "PART 6: FOOD SECURITY/In the past 7 days, how many days did your household restrict consumption by adults so children could eat due to lack of food/money? Reply number of days 0-7", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/Agricultural extension officers (or development agents)", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/Relatives, neighbours or friends", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/Printed newspapers (or their online sites)", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/National radio", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/Local radio", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/TV", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/Online websites (or google searches)", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/Social media such as Facebook and Twitter", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/Don\'t know", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/None of these", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which, if any, of the following sources of information do you use to get agricultural knowledge or advice?/other", "PART 7: SOCIAL CAPITAL AND NETWORKING/InfoSource_other", "PART 7: SOCIAL CAPITAL AND NETWORKING/Have you and/or your spouse been member/s of formal and informal groups/institutions in the last 3 years?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?/Input supply group, farmer cooperative", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?/Crop marketing group", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?/Church/mosque association/congregation", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?/Savings and credit association", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?/Women’s Association/group", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?/Youth Association", "PART 7: SOCIAL CAPITAL AND NETWORKING/Which type of Institution?/other", "PART 7: SOCIAL CAPITAL AND NETWORKING/socnet_2_other", "PART 7: SOCIAL CAPITAL AND NETWORKING/What is the services the group/institution offer?", "PART 7: SOCIAL CAPITAL AND NETWORKING/What is the services the group/institution offer?/Input supply", "PART 7: SOCIAL CAPITAL AND NETWORKING/What is the services the group/institution offer?/Market accessibility", "PART 7: SOCIAL CAPITAL AND NETWORKING/What is the services the group/institution offer?/Credit accessibility", "PART 7: SOCIAL CAPITAL AND NETWORKING/What is the services the group/institution offer?/other", "PART 7: SOCIAL CAPITAL AND NETWORKING/socnet_3_other", "PART 7: SOCIAL CAPITAL AND NETWORKING/What is your/partner\'s role in the group/institution?", "PART 7: SOCIAL CAPITAL AND NETWORKING/socnet_4_other", "PART 7: SOCIAL CAPITAL AND NETWORKING/Is your neighbour a member of the institution mentioned above?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Are any of your friends or relatives in leadership positions in formal or informal institutions within or outside this village?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Think about the people you know in your village that do not live in your household. In a typical week, how many different people from your village do you communicate with? Include all relatives, friends, neighbours and other people who live in your village. The way of communication (in-person or phone) does not matter.", "PART 7: SOCIAL CAPITAL AND NETWORKING/Think about the people you know in your village. In a typical week, how many times do you communicate with each person you know? The way of communication (in-person or phone) does not matter.", "PART 7: SOCIAL CAPITAL AND NETWORKING/Think about the last 10 discussions you had with contacts in your village. In how many discussions were post-harvest losses mentioned?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Think about the last 10 discussions you had with contacts in your village. In how many discussions were hermetic storage bags mentioned?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Now think about people you know that don’t live in your village. In a typical week, how many people outside your village do you communicate with? Include all relatives, friends, traders, extension officers and other people. The way of communication (in-person or phone) does not matter.", "PART 7: SOCIAL CAPITAL AND NETWORKING/Think about the people you know outside your village. In a typical week, how many times do you talk with a typical person? The way of communication (in-person or phone) does not matter.", "PART 7: SOCIAL CAPITAL AND NETWORKING/Think about the last 10 discussions you had with contacts outside of your village. In how many discussions were post-harvest losses mentioned?", "PART 7: SOCIAL CAPITAL AND NETWORKING/Think about the last 10 discussions you had with contacts outside of your village. In how many discussions were hermetic storage bags mentioned?", "Thanks for your time!", "_id", "_uuid", "_submission_time", "_validation_status", "_notes", "_status", "_submitted_by", "_tags", "_index");
            
            // check that only allowed headers are present in csv
            for(String element : header) {
                if(headerList.contains(element) == false) {
                    return "%s is not a valid column name".formatted(element);
                }
            }

            // check that all required headers are present in csv
            for(String element : headerList) {
                if(Arrays.asList(header).contains(element) == false) {
                    return "%s is a required column name".formatted(element);
                }
            }

        } catch (Exception e) {
            return e.getMessage();
        }
        return "ok";
    }
}
